# R API client for dlxapi
## Install / Update
The easiest way to install/update `dlxapir`is to install `devtools` and use`install_github`, a short script to do all of this is:
```{R}
install.packages("devtools")
library(devtools)
install_github("dlens/dlxapi", subdir="R")
library(dlxapir)
```

**NOTE:** On MacOSX:
1. Install R language from [https://cran.rstudio.com/](https://cran.rstudio.com/)
1. Install RStudio from the [RStudio website](https://rstudio.com/products/rstudio/download/#download)
1. Install Xcode from the app store
2. Install the Xcode command line tools by opening a Terminal and running:
```
xcode-select --install
```

## Overview
This API client was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the [OpenAPI/Swagger spec](https://github.com/swagger-api/swagger-spec) from a remote server, you can easily generate an API client.

- API version: 1.0
- Package version: 1.0.0
- Build package: io.swagger.codegen.languages.RClientCodegen

# Quickstarts

## Excel Import
Here is an example of using the `dlxapir` library to import from an Excel file

```{R}
library(dlxapir)
# What dlx instance are we talking with?
dlx_instance = "INSERT_CLIENT_INSTANCE"
# Your id and credentials go here
id = "Your ID Goes Here!"
secret = "Your secret Goes Here!"

# You need an ApiClient object to talk to the server.
# This ApiClient object basically has the auth info
apiClient = apiClientFromCreds(dlx_instance, id, secret)

# Need a PortfoliosApi object to talk to the Portfolio server
portfoliosApi = PortfoliosApi$new()
portfoliosApi$apiClient = apiClient

# Let's get our portfolio, just to make sure things are working
myport = portfolioFromName(apiClient, "Your Portfolio Name Goes Here")
# Print the name just to be sure we actually got the object
print(myport$name)

#We need an SpreadsheetApi object to call to upload our spreadsheet
spreadsheetApi = SpreadsheetApi$new(apiClient)
excel_file="Your_Excel_File_Name_Goes_Here.xlsx"
sheetName = "The sheet in your excel file's name goes here"
#Upload the spreadsheet to the server
spreadsheet = spreadsheetApi$create_spreadsheet(excel_file)
#Now set up the mapping
spreadsheetApi$get_mappings_for_spreadsheet(spreadsheet$content$id, sheetName, "COST", FALSE)
#Now save
rval = portfoliosApi$save_spreadsheet_for_portfolio(myport$id, spreadsheet$content$id, sheetName)

```

## Listing portfolios
```{R}
library(dlxapir)
dlx_instance = "YOUR DLX URL HERE startings with https://"
# Your id and credentials go here
id = "Your ID"
secret = "Your Secret"

# You need an ApiClient object to talk to the server.
# This ApiClient object basically has the auth info
apiClient = apiClientFromCreds(dlx_instance, id, secret)

# Need a PortfoliosApi object to talk to the Portfolio server
portfoliosApi = PortfoliosApi$new()
portfoliosApi$apiClient = apiClient

#List portfolios
ports = portfoliosApi$get_portfolios()
for (port in ports$content$items) {
  print(port$name)
}
```

## Processing errors and reporting
We have 2 simple functions for handling basic processing and error reporting to
hopefull make things easier:

1. `processingReportStart()`: Call this at the beginning of your script to begin the report
2. `processingReportNextNotNull()`: Call this function at each step to check for non-null value
3. `processingReportNextResponse()`: Call this function at each step to check for valid http responses

Here is our example for excel import with processing reporting

```{R}
library(dlxapir)
# What dlx instance are we talking with?
dlx_instance = "YOUR DLX URL HERE startings with https://"
# Your id and credentials go here
id = "Your ID"
secret = "Your Secret"

# Start our report of progress
processingReportStart()
# You need an ApiClient object to talk to the server.
# This ApiClient object basically has the auth info
apiClient = apiClientFromCreds(dlx_instance, id, secret)
processingReportNextNotNull(apiClient, "Setting up API Client")

# Need a PortfoliosApi object to talk to the Portfolio server
portfoliosApi = PortfoliosApi$new()
processingReportNextNotNull(portfoliosApi, "Setting up Portfolios API Client")
portfoliosApi$apiClient = apiClient

# Let's get our portfolio, just to make sure things are working
portfolioName = "YOUR PORTFOLIO NAME HERE"
portfolioId = "OR YOUR PORTFOLIO ID HERE"
#Get portfolio either by id or by name
#myport = portfolioFromName(apiClient, portfolioName)
myport = portfolioFromId(apiClient, portfolioId)

processingReportNextResponse(myport,"Getting a portfolio by name")

#We need an SpreadsheetApi object to call to upload our spreadsheet
spreadsheetApi = SpreadsheetApi$new(apiClient)
processingReportNextNotNull(spreadsheetApi, "Getting Spreadsheet API")
excel_file="YOUR EXCEL FILE HERE.xlsx"
sheetName = "The name of the sheet in the Excel file to import from"
#Upload the spreadsheet to the server
spreadsheet = spreadsheetApi$create_spreadsheet(excel_file)
processingReportNextResponse(spreadsheet, "Uploading Spreadsheet")

#Now set up the mapping
#The second to last parameter is either "COST" to import cost data, or "PROJECT" to import
#project scores on other fields, e.g. Revenue, Risk, NPV, etc.
spreadsheetApi$get_mappings_for_spreadsheet(spreadsheet$content$id, sheetName, "COST", FALSE)
#Now save
rval = portfoliosApi$save_spreadsheet_for_portfolio(myport$content$id, spreadsheet$content$id, sheetName)
processingReportNextResponse(rval, "Performing import")
```

## Listing plans in a portfolio
```{R}
library(dlxapir)
# What dlx instance are we talking with?
dlx_instance = "YOUR DLX URL HERE startings with https://"
# Your id and credentials go here
id = "Your ID"
secret = "Your Secret"
processingReportStart()

# You need an ApiClient object to talk to the server.
# This ApiClient object basically has the auth info
apiClient = apiClientFromCreds(dlx_instance, id, secret)
processingReportNextNotNull(apiClient, "Setting up API Client")


# Need a PortfoliosApi object to talk to the Portfolio server
portfoliosApi = PortfoliosApi$new()
portfoliosApi$apiClient = apiClient
processingReportNextNotNull(portfoliosApi, "Setting up Portfolios API Client")


# Need a PlansApi as well
plansApi = PlansApi$new()
plansApi$apiClient = apiClient
processingReportNextNotNull(plansApi, "Setting up Plans API Client")

# List plans
portfolioPlansApi = PortfolioPlansApi$new(apiClient)
portId = "YOUR PORTFOLIO ID HERE"
port = portfolioFromId(apiClient, portId)
processingReportNextResponse(port, "Getting portfolio")

pplans = portfolioPlansApi$get_portfolio_plans(port$content$id)
processingReportNextResponse(pplans, "Getting plans")
for (pplan in pplans$content$items) {
  cat(pplan$name)
  cat("\n")
}
```
